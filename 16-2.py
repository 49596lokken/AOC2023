#Drunk on bus was not the vibe

f = open("16.txt").read().splitlines()



last = (-1, -1)

def energise(i,j, dir):
    global last
    while True:
        if dir in energised[i][j]:
            return
        energised[i][j].append(dir)

        if (i,j) == (6,0):
            a = 1

        last = (i,j)

        if f[i][j] == "\\":
            dir = dir[::-1]
        
        elif f[i][j] == "/":
            dir = tuple(-i for i in dir[::-1])
        
        elif f[i][j] == "|":
            if dir[0] == 0:
                if i-1 >= 0:
                    energise(i-1, j, (-1, 0)) 
                dir = (1, 0)
        
        elif f[i][j] == "-":
            if dir[1] == 0:
                if j-1 >= 0:
                    energise(i, j-1, (0, -1))
                dir = (0,1)

        if i + dir[0] >= 0 and i + dir[0] < len(energised) and j + dir[1] >= 0 and j+dir[1] < len(energised[0]):
            i,j = i + dir[0], j+dir[1]
        else:
            return
        
        
energised = [[[] for j in i] for i in f]
energise(len(f)-1, 57, (-1, 0))
startposes = []

best = 0
j = 0
for i in range(len(f)):
    energised = [[[] for j in i] for i in f]
    energise(i,0,(0,1))
    startposes.append((i,0))
    ans1 = 0
    for k in energised:
        for j in k:
            if j:
                ans1 += 1
    if ans1 == 8168:
        print(i)
    energised = [[[] for j in i] for i in f]
    energise(i,len(energised[i])-1,(0,-1))
    startposes.append((i,len(energised[i])-1))

    ans2 = 0
    for k in energised:
        for j in k:
            if j:
                ans2 += 1
    if ans2 == 8168:
        print(i)
    best = max(best, ans1, ans2)

print("Going columns")

myAns = ""
for j in range(len(f[0])):
    energised = [[[] for j in i] for i in f]
    energise(0,j,(1,0))
    startposes.append((0,j))
    ans1 = 0
    for i in energised:
        for k in i:
            if k:
                ans1 += 1
    energised = [[[] for j in i] for i in f]
    energise(len(energised)-1,j,(-1,0))
    startposes.append((len(energised)-1,j))
    if ans1 == 8168:
        print(j)

    ans2 = 0
    for i in energised:
        for k in i:
            if k:
                ans2 += 1
    if ans2 == 8168:
        for a in range(len(energised)):
            for b in range(len(energised[a])):
                if energised[a][b]:
                    myAns += "#"
                else:
                    myAns += f[a][b]
            myAns += "\n"
        print("ansed")
    best = max(best, ans1, ans2)

print(best)


realAns = """\\..|#..................|.#..##..\\#.........#.#.\\...#....#......##-#....../.#.......#####.#.#......-.#.....####
....#...../...-/......\\.|#..##...#...../...#.#.....#....#\\.....##.#..\\.....#..-....#.#.#|#.#..\\.-.|.#.....#...
....#..........-.........#.|##...#|...|....#.#./...#...\\#......##.#...########################################
....#....................#..##...#|........#.#.../.#|.|.#./....##.#...#./..##......#.#.#.################.#|..
#########################################################################...#...-..#.#.#.#.#........#...#.#../
....#...-...|.......|.####..##...#.........#.#...############################......#.#.#.#.#...#######..#.#...
#..\\#...........-.\\...#.....##./.#.........#.#...#.#....#......########.#..##......#.#.#.#.#./.#....##..#.#-..
#\\..#|....\\...........#....\\##.|.#......\\-.#.#...#.#....########################.\\.#|#|#.#.#...#....##..#.#...
#...#\\.........\\......######################################################################...#\\...##..#.#...
#...#...........|.....#.....##...#.........#|#...#.#...\\#......#..##########################...#....##..#/#...
#...#.................#.....#########...################################################.#.###################
#...#.....|........./.#....\\#...|#..#...#####################################..#..#..###.#.#.#################
#..|#............/....#.....#....#.\\#.######.#.\\.#/#....#.....##..####..#..#...#..#..###.#.#.#..#...##..#.#.#.
############################################.#...#.#....#.....##..####..#..#...#..#..###.#.#.#..#...##..#.#.#.
##################################################.#....#.....##..####..#..#.-.#..#..###.#.#-#..#...##..#.#.#.
#.-.#............./#..#.....#....#..###.#....#..-..#...-#....-##..####..#..########..###.#.#.#..#...##..#/#.#.
#...#|.....###################################################################################################
#...#......#.......###################################\\.#.....##..####..#..##..#./.-.#########################
#-..#......#..-.......#.....#/#.-#..###.#..#############################################-#.#.#-.##...#########
#...#..-...#...-......#.....#.#..#..###.#..#.#.....#.#..#.##\\.##..#################..#.#.#.###################
#...#./../.#..........#.....#.#..#################.######################..##..#..#..#.#.#...#######.#..#.#.#.
##################...-#.....#.#.....###.#..#####################..#######################################.#\\#.
#..|#########################################################################.##..#.##############/#.#########
#.......#.\\#.....#....#.....#.#.....################-#..#.#..#############.##.##..#.##.#.#...#####\\#.#.##.#.##
#.......#..#..\\..#...-#.....#.#.....###.#...##..##-..#########################################################
##################/####################################.#.#.######################################.#.#.##.#.##
############....##.#..#.....#.#.../.###.##########./.##.#.#.####..############################.###.#.#.##.#.##
.....-..#.....-/###########.#.#.-./.###..#..########.##.#.#.####..############################################
........#.......##################################.#.##-#.#.##############/##.##..#.##.##......###.#.#.##.#/#/
........#..|....##.################.###..#..######.#.##.#.#..###.#########/##.##..#-##.##......###.#.#.##.#.#.
........#.......##........#-#.#./.#.###..#..######.#.##.#.#..###.#########|##.##..#.##\\##......###.#.#.##.#.#.
........#.......##..|.....#.#.#|..#.###..#..######.#/##.#.#..###\\#############################.##########.#.#.
#######################################################.#.#.\\###\\#########.##.##.#############################
..|.....####....##|../....#.#.#...#.###..#..######.#..#.#.#..###.#########\\##################################/
.........\\.#....##........#\\#.################################################################################
...........#....##.\\......#.#...#######..#..######.#..#.#.#.###.####################################.####/#...
......|....#....##....\\...#.#.|.##################.#-.#.#.#.##########################.##|.#########.####.#...
....\\/|....#....##.....-.-#.#...########################################.###################.#..####.####.#...
..|........####.##........#.#...#######..#..#########.#.#.#.###.########\\##.#/####.###.##..#.#..####.####-#...
#####################################################.#.#.##############.##.#-#############################...
###########################################################################.#.####.###.##..#.#################
........#######################################################.##.###########################################
........#|-##.#.##.#....#.#.#...#######./#########.##.#.#/#.##################################################
...\\....#|.##.#.##.#....###############..#########.##.#.#.#.###.##.###.#.##.#..###.###.##..#....##############
.../...-#..##.#.##.#.....|#.#..\\##.#####################################.##.#..###.###\\##..#.....#.#....../...
........#.-##.#.##.#../...#|#...######################################################################....\\###
....../.#..##.#.##.#.\\..####################################################################################.\\
#########..##.#.##.#....#.#.#...##.##################.#.#.#-###-##.#######################|#.....#.#.#.....###
###########################.#...##...##...########.##.#.#.#/###.##.###################################...|.#..
......#.#.#####.##.#....###############...########################-#####.##.#\\.#######.###.#.\\...#.###.....#..
../...#.#.###.#.##.#......#.##################################################################################
......#.#####.#|##.#......#.#..################################.##.#####.##.#..#######.#####################.#
\\.../.#...###.#.##.#......########...#....###..########.#.#####.########.##.#..\\##############################
......#...###.#.##.###########################################################################################
......#...###.#.##.....#..#.#...##..###...###..##...###.####################################....############.#
....|.#...###.#.##.|..-#..#.#..#######################################################################....##.#
#######################################|..###..##./.###.#######..#.#####.##.#...######################.\\..##.#
......#...###.#.##...-.###########..##############################################################..#.....##.#
.....|#...###.#.##...###########|#..####.-###..##...###.######################################################
....#########.#.##...#.##\\#./.##.#..####..###..##...###.################..#.#....##..##.#################.##.#
....##############################..####|.################################################.#.############.##.#
....-.#...###.#.##.....##.#...##-...####..####|##...###.#######..#.#.##########.#########./#.##.#..##\\....##.#
/.....#...###.#.##...\\.##.#...##....###########################################################.#..###########
......#####################################################################.#.#/###..##.#..#############.\\.#.#
..........###.#.##.....####...##..\\-.###..####.##...###.##..###./###.###|##.#.#.###..##.#..##.#.#-####.#...#.#
..........###.#.##.#############.################...###.###################.#.#.##############################
.......######.#.##.#../####...##.#...###..#######...###..#|.#.#..###|######.#.#.##########.##.#.#.####.#...#|#
.../.#############################...###.\\###################.#..###.######.#.#..##..#####.##.#.#.####.#...#.#
.....#.#|.#.#.#.##.#...####...##.#-..###..#######.#.###./###########.######.#.#|#############.#.#.########/#.#
##.\\.#.#.|#.#.#############...##.#..####..###################################################.#.#.####.#.#.#.#
.#...#.#..#.#...##.#.#.##########################################################################.####.#.#.#/#
.#####.#./#.#...##.#.#..##################################################################################.#.#
##.\\##.#..#.#...##.#.#..#.#...########################################################################.#...#.#
....##.#..###################################################################.#####./|#.#.###.#...##.#.#...#.#
....##.#....#\\..##.#.######################################...#..###/####..##.#####...#.#.####################
../.##.#|-..#...##.#.#|.#.#####################################..###.################.#.#.#.#.#...##...#...#.#
....##.#-...#...##.#.##################################################################.#|#\\#.#.\\.##...#...#.#
\\...##.#....#.-\\##.#.##.#.....#####...##.-####.##############....###.####/.##.#####.#-#.#/#\\#.#...##\\..#####.#
....##.#....#...##.#.##.#.....##########..####.####..##.###.########################################..########
....##.#....#|..##.#.##-#.....#.###|..#..-####.####..##.######...###.####..##.#####.#.##########..##..#......#
....##.#....#.|.##.#.##.#...-.#.###...#.#################################################.#.#.##.|##..#......#
....##.#...|#-..##############################################################################################
../.##.#....#.-.####.##.#..-..#############################################################.#.##..##..##-....#
....##.#...########################################################################.#-##..#.#\\################
....##.#...##...####.##.#/.||.#####|..#.###########..################################.##..#\\#..#..##..##.....#
###############################################################..###.###############################..##.....#
############################################...####|.##.###.#.#.|###.#########.####.#.##\\.#.#.-#.###..##.....#
########################################################################################..#.##################
#..###.#...##...#.#################.....###....####..##.##################.###.##############..#..##..##.....#
######.#...##...#..#.#..#.....###.#.....###....####..########.#..###.###################./###..#..############
#...##.#...##...#.-#-#..#.....###.#.....###....###############################################################
#######################.#...\\.###.#.....#####################.#...##.###################################..#..#
#...##.#...##...#..#|##/#\\.################################################.##\\#.#######..###..#..##...#..#..#
###########################################################################.##.#.#######..###..#..##...#-.#..#
########...##...#.\\#.##.############/|..##...|..###\\.#####.##.#.-..#.################################\\.#..#..#
#...#########...#.\\##########################...###..########################################..#..###..#..#|.#
#...#########/..#..#.##.#..#..###.##.|..##..#./.###...####-#############################../##..#\\.###..#######
#...##.#.\\..#...#.|#.##.#.\\#..###.##.|..##..#..#####################.######.#..#..######...###################
#...#############################.##################/|####.##.#...##.######.#..#..######...##..#..###..#..#.#.
#../#..#....#...#..#.#..#\\.#/.#.#.##..\\.#######################...##.######.#..#..######...##|.#..###..#..#.#\\
#...#..#.-..#...#..#.#..#..#..#.#.##....##..#..###.#.-####.####...#########/#..#..######../##|.##############.
#-|.#/.#.../#...#..#.###############....##..#..###.#..####.#########.#####\\.#..#..#########################...
#./.#..#./..#...#..#.#..#..#..#.#.#.....##\\.#..###.#|.##############.#####.\\#..#..#####.\\.###########..#./..\\.
#...#..###############..#..#..#.#.#.....##..#.\\##############################################.....###..#......
#...#..##.#.#...#..###-.#..#..#.#.#../\\.##..#..###.#...###.###############..#..#.\\#.###....##.....############
#################..###..#..#..#.#.#.....##..#./###.#...###.###....#..####...#..#..#.###...\\##..-.-#.#..#......
###########.#...#..###..#..#..#.#.#.....##..#..###.#./.###.###.-..#..#####################/##./...#.#./#......
....#..##.#.#...#..###..#..#.\\#|#.#.....##..#..######..######################################.....######.....\\
..\\-#..##.#######################.#.....########################################..#-#...\\#\\.#.|.....#.........
....#..##...#...#./##...#..#./#...#.....#...#...##.##....#.###.-..#...###...#|.#..#.#....#..#....\\..#........."""


myAns = myAns.splitlines()
realAns = realAns.splitlines()

print(len(myAns), len(realAns), len(f))

for i in range(len(myAns)):
    if myAns[i] != realAns[i]:
        print(i, myAns[i], realAns[i], sep="\n")

print("hi")